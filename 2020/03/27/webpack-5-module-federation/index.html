<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Webpack 5 Module Federation: JavaScript 架构的规则改变者 | RichLab</title>
    <meta name="description" content="RichLab - 荔枝实验室™️ ️· Ant Financial Huabei &amp; Jiebei Front-end Team.">
    <meta name="generator" content="VuePress 1.4.0">
    <link rel="icon" href="https://gw.alipayobjects.com/zos/finxbff/compress-tinypng/7a6ec1c9-2680-4817-8748-eeab10cb1469.png">
  <meta name="referrer" content="no-referrer">
  <meta name="theme-color" content="#272727">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/css/0.styles.3864794d.css" as="style"><link rel="preload" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/app.a56f7067.js" as="script"><link rel="preload" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/14.607a4890.js" as="script"><link rel="preload" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/2.2111b554.js" as="script"><link rel="preload" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/1.d2bc05a5.js" as="script"><link rel="preload" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/7.6da6048c.js" as="script"><link rel="preload" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/12.cea92d77.js" as="script"><link rel="preload" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/11.cf9bfb62.js" as="script"><link rel="prefetch" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/10.2b845a50.js"><link rel="prefetch" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/13.9f5dbed6.js"><link rel="prefetch" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/15.c272ded7.js"><link rel="prefetch" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/16.3de2b3bf.js"><link rel="prefetch" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/17.5e67e189.js"><link rel="prefetch" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/18.4a89eb19.js"><link rel="prefetch" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/19.b33b4129.js"><link rel="prefetch" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/20.9b092dba.js"><link rel="prefetch" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/21.239ec4ff.js"><link rel="prefetch" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/22.fac68e97.js"><link rel="prefetch" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/23.3533a25d.js"><link rel="prefetch" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/5.19640fbc.js"><link rel="prefetch" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/6.f6f88375.js"><link rel="prefetch" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/8.0d5704d8.js"><link rel="prefetch" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/9.8e4d7357.js"><link rel="prefetch" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/vuejs-paginate.f70b902f.js">
    <link rel="stylesheet" href="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/css/0.styles.3864794d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container layout-post"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="https://gw.alipayobjects.com/zos/finxbff/compress-tinypng/b1a25d04-6a13-4bb5-a929-a5f0db08b8de.png" alt="RichLab" class="logo"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/about/" class="nav-link">About</a></div><div class="nav-item"><a href="/blog/" class="nav-link">Blog</a></div><div class="nav-item"><a href="https://github.com/rich-lab" target="_blank" rel="noopener noreferrer" class="nav-link external">Github</a></div><div class="nav-item"><a href="https://github.com/rich-lab/art/" target="_blank" rel="noopener noreferrer" class="nav-link external">Artworks</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/about/" class="nav-link">About</a></div><div class="nav-item"><a href="/blog/" class="nav-link">Blog</a></div><div class="nav-item"><a href="https://github.com/rich-lab" target="_blank" rel="noopener noreferrer" class="nav-link external">Github</a></div><div class="nav-item"><a href="https://github.com/rich-lab/art/" target="_blank" rel="noopener noreferrer" class="nav-link external">Artworks</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Webpack 5 Module Federation: JavaScript 架构的规则改变者</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/2020/03/27/webpack-5-module-federation/#什么是-module-federation" class="sidebar-link">什么是 Module Federation?</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/2020/03/27/webpack-5-module-federation/#术语" class="sidebar-link">术语</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/2020/03/27/webpack-5-module-federation/#构建一个-federated-application" class="sidebar-link">构建一个 federated application</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/2020/03/27/webpack-5-module-federation/#app-one" class="sidebar-link">App One</a></li><li class="sidebar-sub-header"><a href="/2020/03/27/webpack-5-module-federation/#app-two" class="sidebar-link">App Two</a></li><li class="sidebar-sub-header"><a href="/2020/03/27/webpack-5-module-federation/#app-three" class="sidebar-link">App Three</a></li></ul></li><li><a href="/2020/03/27/webpack-5-module-federation/#浏览器中的最终结果（不同于第一个视频）" class="sidebar-link">浏览器中的最终结果（不同于第一个视频）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/2020/03/27/webpack-5-module-federation/#代码冗余" class="sidebar-link">代码冗余</a></li></ul></li><li><a href="/2020/03/27/webpack-5-module-federation/#服务端渲染" class="sidebar-link">服务端渲染</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/2020/03/27/webpack-5-module-federation/#federated-next-js-on-webpack-5" class="sidebar-link">Federated Next.js on Webpack 5</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/2020/03/27/webpack-5-module-federation/#talks-podcasts-or-feedback" class="sidebar-link">Talks, podcasts, or feedback</a></li></ul></li><li><a href="/2020/03/27/webpack-5-module-federation/#module-federation-的一些例子" class="sidebar-link">Module Federation 的一些例子</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/2020/03/27/webpack-5-module-federation/#comments" class="sidebar-link">Comments</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"><div><div class="author"><span class="type-text">Translated by</span> <a href="https://github.com/ulivz" target="_blank" class="author-image"><img src="/authors/ulivz.png" alt></a></div></div> <div class="theme-default-content content__default"><h1 id="webpack-5-module-federation-javascript-架构的规则改变者"><a href="#webpack-5-module-federation-javascript-架构的规则改变者" class="header-anchor">#</a> Webpack 5 Module Federation: JavaScript 架构的规则改变者</h1> <p>Module Federation <code style="font-family:Arail;"><i>[ˌfedəˈreɪʃn]</i></code> 允许一个 JavaScript 应用在客户端或服务器上动态运行来自另一个 bundle 或者 build 的代码。</p> <blockquote><p>原文：<a href="https://medium.com/@ScriptedAlchemy/webpack-5-module-federation-a-game-changer-to-javascript-architecture-bcdd30e02669" target="_blank" rel="noopener noreferrer">Webpack 5 Module Federation: A game-changer in JavaScript architecture<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <hr> <p><strong>Module Federation 之于 JavaScript Bundler，如同 Apollo 之于 GraphQL。</strong></p> <blockquote><p>在独立的 Web 应用之间共享代码的可伸缩解决方案从来都不方便，而且几乎不可能大规模实现。在此之前，我们最接近的是 externals 或者 DLLPlugin，强制把依赖集中于一个外部文件中。共享代码真地很麻烦，表面上独立的应用通常不是真正意义上的独立，而且共享的依赖数量通常有限。此外，在单独打包的 Web 应用之间共享实际的特性代码往往是不可行的、<strong>效果不好的</strong>、没有收益的。</p></blockquote> <h2 id="什么是-module-federation"><a href="#什么是-module-federation" class="header-anchor">#</a> 什么是 Module Federation?</h2> <p>这是我发明并且赋予它最初形态的一种 JavaScript 架构，在我们 Webpack 创始人的帮助下，它变成了 Webpack 5 Core 中最令人兴奋的功能之一（里面有一些很酷的东西，新的 API 非常强大和干净）。</p> <blockquote class="highlight"><p>我非常荣幸向大家介绍 JavaScript 应用程序架构中的一个期待已久的飞跃，我们对于开源社区的贡献：Module Federation。</p></blockquote> <p>Module Federation 允许一个 JavaScript 应用能够从另一个 JavaScript 应用中动态地加载代码 —— 在这个流程中共享着依赖，如果一个应用正在消费的 federated module 没有 federated code 中需要的的依赖，Webpack 将会从 federated 生成源中下载缺少的依赖项。</p> <p>代码可以共享，但在每种情况下都存在降级措施。federated code 可以总是加载自己的依赖，但在下载前会去尝试使用消费者的依赖。更少的代码冗余，依赖共享就像一个单一的 Webpack 构建。虽然我已经实现了这个最初的系统——他是由我自己（<a href="https://medium.com/@ScriptedAlchemy" target="_blank" rel="noopener noreferrer">Zack Jackson<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>）和 <a href="https://medium.com/@maraisr" target="_blank" rel="noopener noreferrer">Marais Rossouw<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 在很多 <a href="https://medium.com/@sokra" target="_blank" rel="noopener noreferrer">Tobias Koppers<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 的帮助和结对编程下完成的。这些开发者在 Webpack 5 的核心重写和稳定化上发挥了十分重要的作用，谢谢你们持续的合作和支持。</p> <h2 id="术语"><a href="#术语" class="header-anchor">#</a> 术语</h2> <p align="center"><img src="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/img/main.50bee209.png" width="400"></p> <ul><li><p><strong>Module federation</strong>: 与 Apollo GraphQL federation 的想法相同 —— 但适用于在浏览器或者 node.js 中的 JavaScript 模块。</p></li> <li><p><strong>A host</strong>：一个在页面加载后（当 <code>onLoad</code> 事件被触发）被初始化的 Webpack 构建；</p></li> <li><p><strong>A remote</strong>：其中一部分被 <strong>“host”</strong> 消费的另一个 Webpack 构建；</p></li> <li><p><strong>Bidirectional（双向的） hosts</strong>：当一个 bundle 或者 webpack build 作为一个 <code>host</code> 或 <code>remote</code> 工作时，要么在 runtime 消费其他的应用，要么被其他应用消费。</p></li></ul> <p>对于那些想要更容易理解这篇文章的人, <a href="https://medium.com/@jherr" target="_blank" rel="noopener noreferrer">Jack Herrington<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 写了一篇!</p> <p align="center"><iframe width="100%" height="315" src="https://www.youtube.com/embed/D3XYAx30CNc" frameborder="1" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="allowfullscreen"></iframe></p> <blockquote class="highlight"><p>值得注意的是，该系统的设计使每个完全独立的构建/应用都可以存放在自己的仓库中，独立部署，并作为独立的 SPA 运行。</p></blockquote> <p>这些应用都是 <strong>bidirectional（双向的） hosts</strong>，任何首先加载的应用在修改路由或者浏览的时候，将成为一个 host，并用你实现 dynamic imports 一样的方式来加载 federated modules，然而，如果你要刷新页面，则无论应用是不是第一次在页面 load 后运行，都将成为一个 host。</p> <p align="center" class="card-link"><a target="_blank" href="https://twitter.com/kmsaldana1/status/1234551387398103043?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed&amp;ref_url=https%3A%2F%2Fcdn.embedly.com%2Fwidgets%2Fmedia.html%3Ftype%3Dtext%252Fhtml%26key%3Da19fcc184b9711e1b4764040d3dc5c07%26schema%3Dtwitter%26url%3Dhttps%253A%2F%2Ftwitter.com%2Fkmsaldana1%2Fstatus%2F1234551387398103043%26image%3Dhttps%253A%2F%2Fi.embed.ly%2F1%2Fimage%253Furl%253Dhttps%25253A%25252F%25252Fpbs.twimg.com%25252Fprofile_images%25252F1016423846809722880%25252FJyBot7JY_400x400.jpg%2526key%253Da19fcc184b9711e1b4764040d3dc5c07"><img src="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/img/kevin-saldana-tweet.dd3638e9.png" width="500"></a></p> <p>假设一个网站的每个页面都是独立部署和编译的，我想要这种微前端风格的架构，但不想在更改路由时页面重新加载，我同时也期望在他们之间动态地共享代码和 vendors，所以它的效率就像是一个有 code splitting 的大型 Webpack 构建。</p> <p>访问应用的 home 也将会使这个 “home” 页成为一个 “host”，如果你切换到 “about” 页，那么这个 host（home page spa）实际上是从另一个独立的应用（about page spa）中动态加载一个模块，它并没有加载应用主入口以及另一个完整的应用。如果我现在在 “about” 页刷新浏览器，“about” 页 将会成为一个 “host”，<strong>只会加载几千字节的代码</strong>。再次回到  “home” 页，将会是 “about” 页（“host” ）从一个 “remote” 获取运行时的一些片段，这个 “remote” 就是 “home” 页 —— 所有的应用都是这个系统中的  “remote”、“host”，可消费的 federated module 或者 federated module 的消费者。</p> <p>可以在 Github 上找到更多的技术细节：</p> <p><a href="https://medium.com/@ScriptedAlchemy/webpack-5-module-federation-a-game-changer-to-javascript-architecture-bcdd30e02669" target="_blank" rel="noopener noreferrer">Merge Proposal: Module federation and code sharing between bundles. Many builds act as one<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="构建一个-federated-application"><a href="#构建一个-federated-application" class="header-anchor">#</a> 构建一个 federated application</h2> <p>让我们从三个独立的应用程序开始。</p> <h3 id="app-one"><a href="#app-one" class="header-anchor">#</a> App One</h3> <h4 id="配置"><a href="#配置" class="header-anchor">#</a> 配置</h4> <p>我将使用 <strong>App One</strong> 中的应用容器 <code>&lt;App&gt;</code>，它将会被另一个应用消费，为此，我 expose App 为 AppContainer，<strong>App One</strong> 将会同时消费来自另外两个 federated applications 中的组件，为此，我指定了 remote 的 scope：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;html-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ModuleFederationPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack/lib/container/ModuleFederationPlugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// other webpack configs...</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">ModuleFederationPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token string">&quot;app_one_remote&quot;</span><span class="token punctuation">,</span>
      remotes<span class="token operator">:</span> <span class="token punctuation">{</span>
        app_two<span class="token operator">:</span> <span class="token string">&quot;app_two_remote&quot;</span><span class="token punctuation">,</span>
        app_three<span class="token operator">:</span> <span class="token string">&quot;app_three_remote&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      exposes<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">'AppContainer'</span><span class="token operator">:</span><span class="token string">'./src/App'</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      shared<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;react&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;react-dom&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;react-router-dom&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      template<span class="token operator">:</span> <span class="token string">&quot;./public/index.html&quot;</span><span class="token punctuation">,</span>
      chunks<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;main&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="设定构建编排流程"><a href="#设定构建编排流程" class="header-anchor">#</a> 设定构建编排流程</h4> <p>在应用的头部，我加载 <code>app_one_remote.js</code> —— 这将让当前的应用连接到其他 Webpack runtimes，并在运行时提供一个编排层（orchestration layer），这是一个专门设计的 Webpack runtime 和 entry point，<strong>但它不是一个普通的应用 entry point，并且只有几 KB</strong>。</p> <p><strong>要注意，这些特殊的 entry points 大小只有几KB —— 它们包含一个特殊的可以与 host 连接的特殊的 Webpack runtime，它们不是标准的 entry point。</strong></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://localhost:3002/app_one_remote.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://localhost:3003/app_two_remote.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="从-remote-消费代码"><a href="#从-remote-消费代码" class="header-anchor">#</a> 从 remote 消费代码</h4> <p><strong>App One</strong> 有一个页面，消费了提个来自 <strong>App Two</strong> 的 dialog 组件：</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">const</span> Dialog <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&quot;app_two_remote/Dialog&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">Page1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Page 1</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">React.Suspense</span></span> <span class="token attr-name">fallback</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Loading Material UI Dialog...<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Dialog</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">React.Suspense</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Page1<span class="token punctuation">;</span>
</code></pre></div><p>路由看起来相当简单：</p> <div class="language-jsx harmony extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Route<span class="token punctuation">,</span> Switch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react-router-dom&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> Page1 <span class="token keyword">from</span> <span class="token string">&quot;./pages/page1&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Page2 <span class="token keyword">from</span> <span class="token string">&quot;./pages/page2&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">Routes</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Switch</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/page1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Page1</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Route</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/page2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Page2</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Route</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Switch</span></span><span class="token punctuation">&gt;</span></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Routes<span class="token punctuation">;</span>
</code></pre></div><p align="center" class="card-link"><a target="_blank" href="https://twitter.com/ScriptedAlchemy/status/1233646967944646657?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed&amp;ref_url=https%3A%2F%2Fcdn.embedly.com%2Fwidgets%2Fmedia.html%3Ftype%3Dtext%252Fhtml%26key%3Da19fcc184b9711e1b4764040d3dc5c07%26schema%3Dtwitter%26url%3Dhttps%253A%2F%2Ftwitter.com%2Fscriptedalchemy%2Fstatus%2F1233805740076224514%26image%3Dhttps%253A%2F%2Fi.embed.ly%2F1%2Fimage%253Furl%253Dhttps%25253A%25252F%25252Fpbs.twimg.com%25252Fprofile_images%25252F1006614185093091337%25252FOAPr0bpP_400x400.jpg%2526key%253Da19fcc184b9711e1b4764040d3dc5c07"><img src="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/img/zack-jackson-tweet.697f516e.png" width="500"></a></p> <h3 id="app-two"><a href="#app-two" class="header-anchor">#</a> App Two</h3> <h4 id="配置-2"><a href="#配置-2" class="header-anchor">#</a> 配置</h4> <p><strong>App Two</strong> 将会导出 Dialog，并让 <strong>App One</strong> 来消费它，<strong>App Two</strong> 将会同时消费 <strong>App One</strong> 的 <code>&lt;App&gt;</code> —— 因此我们把 <code>app_one</code> 设置为一个 “remote”。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;html-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ModuleFederationPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack/lib/container/ModuleFederationPlugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">ModuleFederationPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token string">&quot;app_two_remote&quot;</span><span class="token punctuation">,</span>
      library<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">&quot;var&quot;</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">&quot;app_two_remote&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      filename<span class="token operator">:</span> <span class="token string">&quot;remoteEntry.js&quot;</span><span class="token punctuation">,</span>
      exposes<span class="token operator">:</span> <span class="token punctuation">{</span>
        Dialog<span class="token operator">:</span> <span class="token string">&quot;./src/Dialog&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      remotes<span class="token operator">:</span> <span class="token punctuation">{</span>
        app_one<span class="token operator">:</span> <span class="token string">&quot;app_one_remote&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      shared<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;react&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;react-dom&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;react-router-dom&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      template<span class="token operator">:</span> <span class="token string">&quot;./public/index.html&quot;</span><span class="token punctuation">,</span>
      chunks<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;main&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="消费"><a href="#消费" class="header-anchor">#</a> 消费</h4> <p>这个是根 <code>App</code>：</p> <div class="language-jsx harmony extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Routes <span class="token keyword">from</span> <span class="token string">'./Routes'</span>
<span class="token keyword">const</span> AppContainer <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&quot;app_one_remote/AppContainer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">React.Suspense</span></span> <span class="token attr-name">fallback</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Loading App Container from Host<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">AppContainer</span></span> <span class="token attr-name">routes</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>Routes<span class="token punctuation">}</span></span><span class="token punctuation">/&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">React.Suspense</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span>
</code></pre></div><p>这个是使用了 <code>Dialog</code> 的默认页面：</p> <div class="language-jsx harmony extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>ThemeProvider<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@material-ui/core&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>theme<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./theme&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Dialog <span class="token keyword">from</span> <span class="token string">&quot;./Dialog&quot;</span><span class="token punctuation">;</span>


<span class="token keyword">function</span> <span class="token function">MainPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ThemeProvider</span></span> <span class="token attr-name">theme</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>theme<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Material UI App</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Dialog</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">ThemeProvider</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> MainPage
</code></pre></div><h3 id="app-three"><a href="#app-three" class="header-anchor">#</a> App Three</h3> <p>正如所料，<strong>App Three</strong> 看起来（和<strong>App Two</strong>）很相似。但是，它不消费来自 <strong>App one</strong> 的独立自运行的组件 <code>&lt;App&gt;</code> （没有导航栏和侧边栏），因此，它没有指定任何 “remote”：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">ModuleFederationPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&quot;app_three_remote&quot;</span><span class="token punctuation">,</span>
  library<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">&quot;var&quot;</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">&quot;app_three_remote&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  filename<span class="token operator">:</span> <span class="token string">&quot;remoteEntry.js&quot;</span><span class="token punctuation">,</span>
  exposes<span class="token operator">:</span> <span class="token punctuation">{</span>
    Button<span class="token operator">:</span> <span class="token string">&quot;./src/Button&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  shared<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;react&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;react-dom&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre></div><h2 id="浏览器中的最终结果（不同于第一个视频）"><a href="#浏览器中的最终结果（不同于第一个视频）" class="header-anchor">#</a> 浏览器中的最终结果（不同于第一个视频）</h2> <p>请重点关注 network，来自三个不同服务器的代码正在被整合（federated），三个不同的 bundles，通常来说，建议不要 federate 整个应用的容器，除非你不想享受 SSR 或者渐进式加载带来的好处。不管怎么说，这个概念相当强大。</p> <p align="center" class="card-link"><a target="_blank" href="https://twitter.com/ScriptedAlchemy/status/1234383702433468416?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed&amp;ref_url=https%3A%2F%2Fcdn.embedly.com%2Fwidgets%2Fmedia.html%3Ftype%3Dtext%252Fhtml%26key%3Da19fcc184b9711e1b4764040d3dc5c07%26schema%3Dtwitter%26url%3Dhttps%253A%2F%2Ftwitter.com%2Fscriptedalchemy%2Fstatus%2F1234383702433468416%26image%3Dhttps%253A%2F%2Fpbs.twimg.com%2Fext_tw_video_thumb%2F1234383371863617536%2Fpu%2Fimg%2FlQ-uregGFW3TExzi.jpg"><img src="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/img/zack-jackson-tweet-2.d2caba60.png" width="500"></a></p> <h3 id="代码冗余"><a href="#代码冗余" class="header-anchor">#</a> 代码冗余</h3> <p>这里几乎没有任何的依赖冗余，通过 <code>shared</code> 选项 —— <strong>remotes 将会首先依赖来自 host 的依赖，如果 host 没有依赖，它将会下载自己的依赖。没有代码层面的冗余，而只有内置的冗余。</strong></p> <p align="center" class="card-link"><a target="_blank" href="https://twitter.com/ScriptedAlchemy/status/1233996827814322178?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed&amp;ref_url=https%3A%2F%2Fcdn.embedly.com%2Fwidgets%2Fmedia.html%3Ftype%3Dtext%252Fhtml%26key%3Da19fcc184b9711e1b4764040d3dc5c07%26schema%3Dtwitter%26url%3Dhttps%253A%2F%2Ftwitter.com%2Fscriptedalchemy%2Fstatus%2F1233996827814322178%26image%3Dhttps%253A%2F%2Fi.embed.ly%2F1%2Fimage%253Furl%253Dhttps%25253A%25252F%25252Fpbs.twimg.com%25252Fprofile_images%25252F1006614185093091337%25252FOAPr0bpP_400x400.jpg%2526key%253Da19fcc184b9711e1b4764040d3dc5c07"><img src="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/img/zack-jackson-tweet-3.fc6da9b9.png" width="500"></a></p> <p>然而手动的增加 vendors 或其他的模块不易于拓展，可以利用一个自定义的函数来实现自动化，或者有一个相应的 Webpack 插件，我们的确计划去发布 <code>AutomaticModuleFederationPlugin</code>，并且在 Webpack Core 之外去维护它。既然我们在 Webpack 中已经有了相当好的 code federation 支持，拓展它的功能就不值一提了。</p> <p>现在来了一个大问题… 这和 SSR 有什么关系吗？？</p> <iframe src="https://giphy.com/embed/3oz8xwNlejeJDQREic" width="100%" height="400" frameBorder="0" allowFullScreen="" class="giphy-embed"></iframe><p></p> <h2 id="服务端渲染"><a href="#服务端渲染" class="header-anchor">#</a> 服务端渲染</h2> <p>我们将其设计成了可以在任何环境下工作的 “通用模块 Federation”，服务端渲染 federated code 是完全可以的。只要让服务器构建使用一个 <code>commonjs</code> 的 library target。实现 federated SSR 有很多种办法，S3 Streaming, ESI, 自动化一个 npm 发布去消费服务器的变化内容，我计划去使用一个常用的共享文件的 volume 或者移步的 S3 streaming 来跨文件系统传输文件。让服务器能够像在浏览器中一样去 require federated code，使用 fs 而不是 http 来加载 federated code。</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
 plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">ModuleFederationPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
   name<span class="token operator">:</span> <span class="token string">&quot;container&quot;</span><span class="token punctuation">,</span>
   library<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">&quot;commonjs-module&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
   filename<span class="token operator">:</span> <span class="token string">&quot;container.js&quot;</span><span class="token punctuation">,</span>
   remotes<span class="token operator">:</span> <span class="token punctuation">{</span>
    containerB<span class="token operator">:</span> <span class="token string">&quot;../1-container-full/container.js&quot;</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
   shared<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;react&quot;</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
 <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><iframe src="https://giphy.com/embed/aNZjVWeD1hBCg" width="100%" height="400" frameBorder="0" allowFullScreen="" class="giphy-embed"></iframe><p></p> <blockquote class="highlight"><p>“Module Federation 当然也适用于 <code>target: &quot;node&quot;</code>，这里使用指向其他微前端应用的文件路径，而不是 URLs。这样的话你就可以用同样的代码，外加不一样的 Webpack 配置来在 node.js 中实现 SSR。其他的 Module Federation 特性在 node.js 都保持不变，如独立构建、独立部署。—— Tobias Koppers</p></blockquote> <h2 id="federated-next-js-on-webpack-5"><a href="#federated-next-js-on-webpack-5" class="header-anchor">#</a> Federated Next.js on Webpack 5</h2> <p>Federation 依赖 Webpack 5 —— Next 并未官方支持。然而，我已经 fork Next.js，并想办法让 Next.js 升级到 Webpack 5 能够 work！这项工作仍在持续中，一些开发模式下的中间件需要完成。生产模式已经 work，但某些附加的 loaders 仍然需要重新测试。</p> <p><a href="https://github.com/module-federation/next.js/pull/2" target="_blank" rel="noopener noreferrer">feat: Upgrade Next.js to Webpack 5<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p align="center" class="card-link"><a target="_blank" href="https://twitter.com/ScriptedAlchemy/status/1234373741246730241?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed&amp;ref_url=https%3A%2F%2Fcdn.embedly.com%2Fwidgets%2Fmedia.html%3Ftype%3Dtext%252Fhtml%26key%3Da19fcc184b9711e1b4764040d3dc5c07%26schema%3Dtwitter%26url%3Dhttps%253A%2F%2Ftwitter.com%2Fscriptedalchemy%2Fstatus%2F1234373741246730241%26image%3Dhttps%253A%2F%2Fpbs.twimg.com%2Fprofile_images%2F1006614185093091337%2FOAPr0bpP_400x400.jpg"><img src="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/img/zack-jackson-tweet-4.e3f9e600.png" width="500"></a></p> <h3 id="talks-podcasts-or-feedback"><a href="#talks-podcasts-or-feedback" class="header-anchor">#</a> Talks, podcasts, or feedback</h3> <p>我非常想有和大家分享关于这项技术的机会，如果你想要使用 <code>Module Federation</code> 或者 <code>Federated architecture</code>，我们想要听到你的反馈并且可能会对现有的架构进行一些调整。我们也非常期望能够有机会在 Podcasts、meetups 或者 corporations 中讨论它。你可以通过 <a href="https://twitter.com/ScriptedAlchemy" target="_blank" rel="noopener noreferrer">Twitter<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 联系到我。</p> <p align="center" class="card-link"><p><a href="https://twitter.com/ScriptedAlchemy" target="_blank" rel="noopener noreferrer"><img src="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/img/zack-jackson.394798df.png" alt=""><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></p> <p>你还可以联系我的 co-creator，来了解 Module Federation 最新的一些变化、FOSA (Federation of Standalone Applications) 架构，以及我们正在做的其他工具 —— 用于和 Federated Applications 一起工作的工具。</p> <p align="center" class="card-link"><p><a href="https://twitter.com/codervandal" target="_blank" rel="noopener noreferrer"><img src="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/img/marais.47b61a05.png" alt=""><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></p> <h2 id="module-federation-的一些例子"><a href="#module-federation-的一些例子" class="header-anchor">#</a> Module Federation 的一些例子</h2> <p>社区对 Module Federation 的反馈非常热烈！Co-creators 和我的大部分时间，都集中在将这项特性写到 Webpack 5 中，我们期望一些代码样例能够帮助我们完成剩余的特性，以及书写文档。</p> <p align="center" class="card-link"><p><a href="https://dev.to/marais/webpack-5-and-module-federation-4j1i" target="_blank" rel="noopener noreferrer"><img src="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/img/example-1.82bb8503.png" alt=""><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></p> <p>我们将创建一些 SSR 示例和更全面的 demo，如果有人想建设一些可以作为 demo 的东西 —— 我们很乐意接受提交给 <code>webpack-external-import</code> 的 pull requests。</p> <p align="center" class="card-link"><p><a href="https://github.com/module-federation/module-federation-examples" target="_blank" rel="noopener noreferrer"><img src="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/img/example-2.a2d4dddd.png" alt=""><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></p> <p align="center" class="card-link"><p><a href="https://github.com/module-federation/module-federation-examples" target="_blank" rel="noopener noreferrer"><img src="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/img/example-3.d6dd39a9.png" alt=""><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></p> <p align="center" class="card-link"><p><a href="https://github.com/ScriptedAlchemy/webpack-external-import" target="_blank" rel="noopener noreferrer"><img src="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/img/example-4.ff879f44.png" alt=""><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></p> <p>Thanks to Tobias Koppers.</p> <h2 id="comments"><a href="#comments" class="header-anchor">#</a> Comments</h2></div> <footer class="page-edit"><!----> <!----></footer> <!----> <div class="custom-page-bottom"><div class="comments-wrapper"><div class="valine-wrapper"><div id="valine"></div></div></div></div></main></div><div class="global-ui"><!----></div></div>
    <script src="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/app.a56f7067.js" defer></script><script src="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/14.607a4890.js" defer></script><script src="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/2.2111b554.js" defer></script><script src="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/1.d2bc05a5.js" defer></script><script src="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/7.6da6048c.js" defer></script><script src="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/12.cea92d77.js" defer></script><script src="https://richlab.oss-cn-hangzhou.aliyuncs.com/assets/js/11.cf9bfb62.js" defer></script>
  </body>
</html>
